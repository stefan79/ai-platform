services:
  traefik:
    image: traefik:v3.2.2
    container_name: ai-platform-traefik
    command: ['--configFile=/etc/traefik/traefik.yml']
    ports:
      - '80:80'
      - '443:443'
    volumes:
      - ./infra/traefik/traefik.yml:/etc/traefik/traefik.yml:ro
      - ./infra/traefik/dynamic.yml:/etc/traefik/dynamic.yml:ro
      - ./certs:/certs:ro
    extra_hosts:
      - 'host.docker.internal:host-gateway'

  redpanda:
    image: docker.redpanda.com/redpandadata/redpanda:v23.3.12
    container_name: ai-platform-redpanda
    command:
      [
        'redpanda',
        'start',
        '--overprovisioned',
        '--smp',
        '1',
        '--memory',
        '1G',
        '--reserve-memory',
        '0M',
        '--node-id',
        '0',
        '--check=false',
        '--kafka-addr',
        'PLAINTEXT://0.0.0.0:9092',
        '--advertise-kafka-addr',
        'PLAINTEXT://localhost:9092',
      ]
    ports:
      - '9092:9092'
      - '9644:9644'

  dynamodb:
    image: amazon/dynamodb-local:2.5.2
    container_name: ai-platform-dynamodb
    command: ['-jar', 'DynamoDBLocal.jar', '-sharedDb', '-dbPath', '/home/dynamodblocal/data']
    ports:
      - '8000:8000'
    volumes:
      - ./dynamodb-data:/home/dynamodblocal/data
