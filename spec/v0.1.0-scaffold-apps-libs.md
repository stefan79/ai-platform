# Spec: v0.1.0 scaffold apps/server, apps/client, libs/*

## Summary
Scaffold the initial Nx apps and libraries for the AI Platform v0.1.0 milestone. Deliver a Fastify backend, a React + Vite frontend, shared protocol types, and baseline tooling (tests, linting, CI, and dev workflow). Keep the implementation minimal and aligned with Nx defaults. Define a read-only server state in `context-core` that exposes version and health; REST reads from this state.

## Goals
- Generate `apps/server` (Fastify + TypeScript) and `apps/client` (React + TypeScript, Vite, Tailwind).
- Provide REST endpoints `/api/health` and `/api/version`, with shared types in `libs/protocol-rest`.
- Scaffold server REST now; no WebSocket implementation in v0.1.0.
- Ensure logging uses `pino`/`pino/browser` with `info` in dev, `warn` in prod.
- Set up testing for backend (Jest) and frontend (Vitest).
- Add `libs/context-core`, `libs/protocol-ws` (placeholder for later), and `libs/design-tokens`.
- Provide Nx-based dev, build, lint, and test workflows.
- Add GitHub Actions CI for `pnpm nx lint`, `pnpm nx test`, `pnpm nx build`, `pnpm nx format:check`.
- Use Zod schemas as the source of truth for protocol types, with inferred TypeScript types and helpers for validation and response creation.

## Non-goals
- Implement WebSocket handling or protocol runtime logic.
- Implement state mutation via events/effects (read-only state only in v0.1.0).
- Full UX design or complex UI layout.
- Multi-tenant or sandboxing features.

## Scope by project

### `apps/server`
- Nx app using Fastify + TypeScript.
- `pino` logger with `info` in dev and `warn` in prod.
- REST endpoints:
  - `GET /api/health` → `{ "status": "ok", "version": "<serverVersion>" }`.
  - `GET /api/version` → `{ "version": "<serverVersion>" }`.
- REST reads the server state from `libs/context-core` via its TypeScript API.
- `context-core` is passed into the server as a dependency (not a global singleton).
- `serverVersion` sourced from root `package.json`.
- Jest tests for the endpoints.

### `apps/client`
- Nx app using React + TypeScript + Vite + Tailwind CSS.
- Fetch `/api/health` and render `status` and `version`.
- `pino/browser` logger with `info` in dev and `warn` in prod.
- Vitest tests for the health fetch/render.

### `libs/context-core`
- Server state (read-only for v0.1.0):
  - `version` string (from root `package.json`)
  - `health.status` (e.g. `"ok"`)
- Future direction (not in v0.1.0): events will reduce against state and generate effects. Effect handlers/types will allow patching state.

### `libs/protocol-rest`
- Zod schemas for `/api/health` and `/api/version` responses.
- TypeScript types inferred from Zod schemas.
- Helpers to validate payloads and create typed response objects.

### `libs/protocol-ws`
- Placeholder types; no runtime wiring.

### `libs/design-tokens`
- Define CSS variables or tokens file.
- Wire tokens into Tailwind theme and default styling.

## API contracts
- `HealthResponse` → `{ status: "ok"; version: string }`.
- `VersionResponse` → `{ version: string }`.
- All protocol types are inferred from Zod schemas; server/client validate payloads before processing.

## Dev workflow
- Provide `nx serve` entrypoint to run both server and client (e.g. `nx run-many -t serve`).
- Ensure frontend calls backend via local dev proxy or configured base URL.

## CI
- GitHub Actions workflow running:
  - `pnpm nx lint`
  - `pnpm nx test`
  - `pnpm nx build`
  - `pnpm nx format:check`

## Acceptance criteria
- Opening the app renders a page with `status` and `version` from `/api/health`.
- Frontend calls backend REST endpoints successfully.
- `nx serve` runs both apps locally.
- CI workflow executes lint/test/build/format on pushes and PRs.

## Implementation checklist
- Add Nx generators for Fastify server and React client (TypeScript).
- Add libs: `context-core`, `protocol-rest`, `protocol-ws`, `design-tokens`.
- Define server state in `context-core` (version + health), read-only for v0.1.0.
- Implement REST routes to read from server state and shared response types.
- Configure logging levels for dev/prod in both apps.
- Add Jest/Vitest tests for the REST endpoint and UI render.
- Add Tailwind tokens integration.
- Wire `nx run-many -t serve` for dev startup.
- Add GitHub Actions CI workflow.
